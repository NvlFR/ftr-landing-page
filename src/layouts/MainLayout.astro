---
// src/layouts/MainLayout.astro

import '../styles/global.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

const { title, description = "FTR - Solusi Cerdas Chatbot AI untuk Bisnis Anda. Customer Service, Personal Finance, Tracking Resi, dan lainnya." } = Astro.props;

// Preload critical resources
const preloadResources = [
  { href: "/fonts/inter-var.woff2", as: "font", type: "font/woff2", crossorigin: "anonymous" },
];
---
<!doctype html>
<html lang="id" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#2563eb" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={Astro.url.origin} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={`${Astro.url.origin}/og-image.jpg`} />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={Astro.url.origin} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={`${Astro.url.origin}/og-image.jpg`} />

    <!-- Preload critical resources -->
    {preloadResources.map(resource => (
      <link 
        rel="preload" 
        href={resource.href} 
        as={resource.as} 
        type={resource.type} 
        crossorigin={resource.crossorigin}
      />
    ))}
    
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    
    <title>{title} | FTR Technologies</title>
    
    <!-- Schema.org structured data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "FTR Technologies",
        "url": "{Astro.url.origin}",
        "logo": "{Astro.url.origin}/logo.png",
        "description": "{description}",
        "address": {
          "@type": "PostalAddress",
          "addressCountry": "ID"
        },
        "contactPoint": {
          "@type": "ContactPoint",
          "telephone": "+62-857-0384-6460",
          "contactType": "customer service",
          "areaServed": "ID",
          "availableLanguage": ["Indonesian", "English"]
        }
      }
    </script>
  </head>

  <body class="antialiased bg-white dark:bg-gray-900 transition-colors duration-300">
    <!-- Progress Bar -->
    <div id="progress-bar" class="fixed top-0 left-0 w-0 h-1 bg-gradient-to-r from-blue-600 to-indigo-600 z-50 transition-all duration-300"></div>

    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:z-50 focus:bg-blue-600 focus:text-white focus:px-4 focus:py-2 focus:rounded-lg">
      Loncat ke konten utama
    </a>

    <Header />
    
    <main id="main-content" class="min-h-screen">
      <slot />
    </main>
    
    <Footer />

    <!-- Back to Top Button -->
    <button 
      id="back-to-top" 
      class="fixed bottom-8 right-8 w-12 h-12 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-300 opacity-0 invisible transform translate-y-10 z-40 group"
      aria-label="Kembali ke atas"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 group-hover:-translate-y-0.5 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7" />
      </svg>
    </button>

    <!-- Loading Spinner (for potential future SPA functionality) -->
    <div id="loading-spinner" class="fixed inset-0 bg-white dark:bg-gray-900 flex items-center justify-center z-50 opacity-0 pointer-events-none transition-opacity duration-300">
      <div class="w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"></div>
    </div>

    <script is:inline>
      // Progress bar functionality
      window.addEventListener('scroll', () => {
        const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
        const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        const scrolled = (winScroll / height) * 100;
        document.getElementById('progress-bar').style.width = scrolled + '%';
      });

      // Back to top button functionality
      const backToTopButton = document.getElementById('back-to-top');
      
      window.addEventListener('scroll', () => {
        if (window.scrollY > 300) {
          backToTopButton.classList.remove('opacity-0', 'invisible', 'translate-y-10');
          backToTopButton.classList.add('opacity-100', 'visible', 'translate-y-0');
        } else {
          backToTopButton.classList.remove('opacity-100', 'visible', 'translate-y-0');
          backToTopButton.classList.add('opacity-0', 'invisible', 'translate-y-10');
        }
      });

      backToTopButton.addEventListener('click', () => {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });

      // Theme detection (respect system preference)
      if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }

      // Smooth scrolling for anchor links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        });
      });

      // Intersection Observer for animations
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('animate-in-view');
            observer.unobserve(entry.target);
          }
        });
      }, observerOptions);

      // Observe elements with animation classes
      document.addEventListener('DOMContentLoaded', () => {
        const animatedElements = document.querySelectorAll('.animate-on-scroll');
        animatedElements.forEach(el => observer.observe(el));
      });

      // Handle loading states
      window.addEventListener('load', () => {
        document.getElementById('loading-spinner').classList.add('opacity-0');
        setTimeout(() => {
          document.getElementById('loading-spinner').classList.add('pointer-events-none');
        }, 300);
      });
    </script>
  </body>
</html>

<style is:global>
  /* Import Inter font */
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
  
  /* CSS Variables for consistent theming */
  :root {
    --color-primary: 59 130 246;
    --color-secondary: 139 92 246;
    --color-success: 34 197 94;
    --color-warning: 234 179 8;
    --color-error: 239 68 68;
    --color-background: 255 255 255;
    --color-foreground: 15 23 42;
    --color-muted: 100 116 139;
    --color-border: 226 232 240;
    --font-sans: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  }

  .dark {
    --color-background: 15 23 42;
    --color-foreground: 248 250 252;
    --color-muted: 148 163 184;
    --color-border: 51 65 85;
  }

  /* Base styles */
  * {
    box-sizing: border-box;
    border-color: rgb(var(--color-border));
  }

  body {
    font-family: var(--font-sans);
    background-color: rgb(var(--color-background));
    color: rgb(var(--color-foreground));
    line-height: 1.6;
    margin: 0;
    padding: 0;
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  /* Accessibility improvements */
  .skip-link {
    position: absolute;
    top: -40px;
    left: 0;
    background: rgb(var(--color-primary));
    color: white;
    padding: 8px;
    z-index: 10000;
    transition: top 0.3s;
  }

  .skip-link:focus {
    top: 0;
  }

  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  /* Smooth scrolling */
  html {
    scroll-behavior: smooth;
    scroll-padding-top: 80px;
  }

  /* Selection color */
  ::selection {
    background-color: rgb(var(--color-primary) / 0.2);
    color: rgb(var(--color-foreground));
  }

  /* Focus styles for accessibility */
  :focus-visible {
    outline: 2px solid rgb(var(--color-primary));
    outline-offset: 2px;
  }

  /* Custom scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
  }

  ::-webkit-scrollbar-track {
    background: rgb(var(--color-background));
  }

  ::-webkit-scrollbar-thumb {
    background: rgb(var(--color-muted) / 0.5);
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: rgb(var(--color-muted));
  }

  /* Animation classes */
  .animate-in-view {
    animation: fadeInUp 0.8s ease forwards;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes slideInRight {
    from {
      opacity: 0;
      transform: translateX(30px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  /* Utility classes for animations */
  .animate-delay-100 {
    animation-delay: 100ms;
  }

  .animate-delay-200 {
    animation-delay: 200ms;
  }

  .animate-delay-300 {
    animation-delay: 300ms;
  }

  .animate-duration-500 {
    animation-duration: 500ms;
  }

  .animate-duration-700 {
    animation-duration: 700ms;
  }

  /* Reduced motion for accessibility */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }
</style>